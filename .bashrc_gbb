#!/bin/bash

# Eternal bash history.
# ---------------------
# Undocumented feature which sets the size to "unlimited".
# http://stackoverflow.com/questions/9457233/unlimited-bash-history
export HISTFILESIZE=
export HISTSIZE=
export HISTTIMEFORMAT="[%F %T] "
# Change the file location because certain bash sessions truncate .bash_history file upon close.
# http://superuser.com/questions/575479/bash-history-truncated-to-500-lines-on-each-login
export HISTFILE=~/.bash_history_eternal

# FZF
export FZF_DEFAULT_OPTS="--height 100% --layout=reverse"
export FZF_CTRL_T_OPTS="--preview 'gfzfpreview {}'"
export FZF_ALT_C_OPTS="--preview 'gfzfpreview {}'"
export FZF_ALT_C_COMMAND="command find -L . \
    -mindepth 1 \\( -path '*target/wasm32*' -o -path '*target/x86_64*' -o -path '*target/debug/*' -o -path '*target/release/*' -o -path '*/node_modules*' -o -path './snap*' -o -path './go*' -o -path '*/__pycache__' -o -path '*/\\.*' -o -fstype 'sysfs' -o -fstype 'devfs' -o -fstype 'devtmpfs' -o -fstype 'proc' \\) -prune \
    -o -type d -print 2> /dev/null | cut -b3-"
export FZF_COMPLETION_OPTS="--preview 'gfzfpreview {}'"
source /usr/share/doc/fzf/examples/key-bindings.bash
bind "$(bind -s | grep '^"\\ec"' | sed 's/\\ec/\\C-f/')" # Rebind ATL-C to CTRL-F

# Starship
command -v starship >/dev/null 2>&1 && source <(starship init bash)

# Direnv
command -v direnv >/dev/null 2>&1 && source <(direnv hook bash)

# Kubectl
export USE_GKE_GCLOUD_AUTH_PLUGIN=True
command -v kubectl >/dev/null 2>&1 && source <(kubectl completion bash)

# Enable/disable kubectl with ke/kd
alias kd='export KUBECONFIG=/dev/null'
alias ke='export KUBECONFIG=~/.kube/config && clear'
kd # Disable by default

# Enable vi mode
set -o vi

# Add Aliases
source $HOME/.aliases
