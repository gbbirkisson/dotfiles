# Eternal bash history.
# ---------------------
# Undocumented feature which sets the size to "unlimited".
# http://stackoverflow.com/questions/9457233/unlimited-bash-history
export HISTFILESIZE=
export HISTSIZE=
export HISTTIMEFORMAT="[%F %T] "
# Change the file location because certain bash sessions truncate .bash_history file upon close.
# http://superuser.com/questions/575479/bash-history-truncated-to-500-lines-on-each-login
export HISTFILE=~/.bash_history_eternal
# Force prompt to write history after every command.
# http://superuser.com/questions/20900/bash-history-loss
PROMPT_COMMAND="history -a; $PROMPT_COMMAND"


# Starship
source <(starship init bash)

# ASDF
source $HOME/.asdf/asdf.sh
source $HOME/.asdf/completions/asdf.bash

# Kubectl
export USE_GKE_GCLOUD_AUTH_PLUGIN=True
source <(kubectl completion bash)

# DirEnv
source <(direnv hook bash)

# FZF
export FZF_DEFAULT_OPTS="--height 100% --layout=reverse"
export FZF_CTRL_T_OPTS="--preview 'gfzfpreview {}'"
export FZF_ALT_C_OPTS="--preview 'gfzfpreview {}'"
export FZF_ALT_C_COMMAND="command find -L . \
    -mindepth 1 \\( -path '*target/debug/*' -o -path '*target/release/*' -o -path '*/node_modules*' -o -path './snap*' -o -path './go*' -o -path '*/__pycache__' -o -path '*/\\.*' -o -fstype 'sysfs' -o -fstype 'devfs' -o -fstype 'devtmpfs' -o -fstype 'proc' \\) -prune \
    -o -type d -print 2> /dev/null | cut -b3-"
export FZF_COMPLETION_OPTS="--preview 'gfzfpreview {}'"
source /usr/share/doc/fzf/examples/key-bindings.bash
bind "$(bind -s | grep '^"\\ec"' | sed 's/\\ec/\\C-f/')" # Rebind ATL-C to CTRL-F

# Set title function
function set_win_title(){
    echo -ne "\033]0; terminal - $PWD \007"
}
starship_precmd_user_func="set_win_title"

# Enable vi mode
set -o vi

# Add Aliases
source $HOME/.aliases
